<!DOCTYPE html>
<html lang="es">
  <head>
    <link rel="stylesheet" type="text/css" href="../css/estilosIniciarSesion.css">
    <meta charset="UTF-8" />
    <title>Estimazon - Iniciar Sesión</title>
  </head>
  <body>
    <div class="contenedor-inicio-sesion">
      <div class="titulo">ESTIMAZON - Iniciar Sesión</div>
      <div class="opciones-inicio-sesion">
        <button class="boton-inicio-sesion" onclick="seleccionarTipo(this, 'vendedor')">Vendedor</button>
        <button class="boton-inicio-sesion" onclick="seleccionarTipo(this, 'comprador')">Comprador</button>
        <button class="boton-inicio-sesion" onclick="seleccionarTipo(this, 'controlador')">Controlador</button>
      </div>
      <div class="campos-inicio-sesion">
        <input type="text" placeholder="Correo de usuario" id="correoUsuario" />
        <input type="password" placeholder="Contraseña" id="contrasenya" />
      </div>
      <button class="boton-enviar" onclick=enviarFormulario()>Enviar</button>
    </div>

    <script>
      let tipoSeleccionado = '';

      function seleccionarTipo(boton, tipo) {
        tipoSeleccionado = tipo;
        // Eliminar la clase "seleccionado" de todos los botones
        document.querySelectorAll('.boton-inicio-sesion').forEach(b => b.classList.remove('seleccionado'));
        // Aplicar la clase "seleccionado" al botón clicado
        boton.classList.add('seleccionado');
      }

      function enviarFormulario() {
        // Obtener los valores del formulario
        let correoUsuario = document.getElementById('correoUsuario').value;
        let contrasenya = document.getElementById('contrasenya').value;
        let tipoUsuario = tipoSeleccionado;

        // Verificar que los campos no estén vacíos
        if (!correoUsuario || !contrasenya || !tipoUsuario) {
            alert('Por favor, completa todos los campos.');
            return;
        }

        // Realizar la solicitud AJAX
        fetch('guardar_sesion.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                correo: correoUsuario,
                contrasenya: contrasenya,
                tipo: tipoUsuario,
            }),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // Manejar la respuesta del servidor aquí
            if (data.success) {
                //alert('Inicio de sesión exitoso.');
                // Redirigir o realizar otras acciones según sea necesario
                if (tipoUsuario == "vendedor" || tipoUsuario == "controlador") {
                  window.location.href = "../interfaz_" + tipoUsuario + ".php";
                } else { // comprador
                  window.location.href = '../estimazon.html';
                }
            } else {
                alert('Error al iniciar sesión: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Hubo un problema al procesar la solicitud. Por favor, inténtalo de nuevo más tarde.');
        });
    }
    </script>
</body>
</html>